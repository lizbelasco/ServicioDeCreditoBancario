package com.buro.rest;

import java.util.ArrayList;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RestController;

import com.buro.business.TablaAmorBusiness;
import com.buro.dto.FilaTablaAmortizacion;
import com.buro.dto.RequestTablaAmor;

@RestController
public class TablaAmor {

    @Autowired
    private TablaAmorBusiness business;
    
    @PostMapping("/generarTablaAmortizacion")
    public List<FilaTablaAmortizacion> generarTablaAmortizacion(@RequestBody RequestTablaAmor request) {
        List<FilaTablaAmortizacion> amortizationTable = new ArrayList<>();

        double interesMensualRate = request.getPorcentaje() / 100 / 12;
        double pagoMensual = business.pagoMensual(request.getMonto(), interesMensualRate, request.getMeses());

        double balance = request.getMonto();

        for (int meses = 1; meses <= request.getMeses(); meses++) {
            double interes = balance * interesMensualRate;
            double capital = pagoMensual - interes;
            balance -= capital;

            FilaTablaAmortizacion fila = new FilaTablaAmortizacion();
            fila.setMes(meses);
            fila.setPago(pagoMensual);
            fila.setInteres(interes);
            fila.setCapital(capital);
            fila.setBalance(balance);
            fila.setTotalInteres(fila.getTotalInteres() + interes);

            amortizationTable.add(fila);
        }

        return amortizationTable;
    }
}

